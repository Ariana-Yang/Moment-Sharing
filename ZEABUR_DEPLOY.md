# Zeabur 部署指南

## 前提条件

1. 完成 Supabase 项目设置（数据库 + Storage）
2. 确保 Storage bucket `photos` 已设置为公开访问
3. 准备好 Zeabur 账号

## 部署步骤

### 1. 准备环境变量

在 Zeabur 项目中设置以下环境变量：

```bash
VITE_SUPABASE_URL=https://你的项目ID.supabase.co
VITE_SUPABASE_ANON_KEY=你的匿名密钥
```

获取方式：
1. 登录 [Supabase Dashboard](https://supabase.com/dashboard)
2. 选择你的项目
3. 左侧菜单 → **Settings** → **API**
4. 复制 **Project URL** 和 **anon public** key

### 2. 在 Zeabur 上部署

#### 方式A：通过 GitHub 部署（推荐）

1. 将代码推送到 GitHub
2. 登录 [Zeabur Dashboard](https://dash.zeabur.com/)
3. 创建新项目
4. 选择 **Git** → 选择你的 GitHub 仓库
5. Zeabur 会自动识别为 Vite 项目
6. 添加环境变量（见步骤1）
7. 点击 **Deploy**

#### 方式B：通过 Zeabur CLI

```bash
# 安装 Zeabur CLI
npm install -g zeabur

# 登录
zeabur login

# 部署
cd E:\Claude\Moment-Sharing
zeabur deploy
```

### 3. 配置自定义域名（可选）

1. 在 Zeabur 项目中，进入 **Domains** 设置
2. 添加你的自定义域名
3. 按照提示配置 DNS 记录

## 部署后配置

### 1. 首次使用设置密码

**在第一个设备上（设备A）：**
1. 打开网站
2. 系统提示"设置密码"（因为数据库还没有用户）
3. 设置**查看密码**（至少6位）
4. 设置**编辑密码**（至少6位）
5. 完成设置，开始使用

**在第二个设备上（设备B）：**
1. 打开网站
2. 系统显示"输入密码"界面（因为数据库已有用户）
3. 输入设备A设置的**查看密码**
4. 验证成功，可以看到所有数据 ✅

**在第三个设备上（设备C）：**
1. 打开网站
2. 输入相同的**查看密码**
3. 验证成功，可以看到所有数据 ✅

### 2. 数据同步验证

在设备A上：
1. 上传照片
2. 创建记忆

在设备B上：
1. **刷新页面**（重要！）
2. 应该能看到设备A上传的照片和记忆 ✅

## 多设备使用说明

### ✅ 可以同步的内容
- 所有记忆（日期、备注）
- 所有照片
- 所有用户数据

### ✅ 密码使用说明
- **第一个设备**：首次访问时需要**设置密码**（查看密码 + 编辑密码）
- **其他设备**：首次访问时只需**输入已设置的密码**即可
- **所有设备必须使用相同的密码**（因为只有一个用户账户）

### 📝 使用流程示例

**设备A（家里电脑）- 首次使用：**
1. 打开网站 → 系统检测数据库无用户
2. 显示"设置密码"界面
3. 设置查看密码和编辑密码
4. 开始上传照片和创建记忆

**设备B（手机）- 首次使用：**
1. 打开网站 → 系统检测数据库**已有用户**
2. 显示"输入密码"界面（不是设置密码）✅
3. 输入设备A设置的密码
4. 验证成功 → 可以查看所有数据 ✅

**设备C（公司电脑）- 首次使用：**
1. 打开网站 → 系统检测数据库**已有用户**
2. 显示"输入密码"界面 ✅
3. 输入相同的密码
4. 验证成功 → 可以查看所有数据 ✅

### 🔄 数据实时同步
- 设备A上传的照片，设备B需要**刷新页面**才能看到
- Supabase 没有实时订阅功能（当前版本）
- 未来可以考虑添加实时同步功能

## 常见问题

### Q: 为什么需要在每个设备上设置密码？
A: 因为密码存储在浏览器的 localStorage 中（本地存储），不是云存储。这是为了简化架构，移除了对 Supabase Auth 的依赖。

### Q: 不同设备设置不同的密码会怎样？
A: 每个设备使用自己设置的密码来验证。只要能验证成功，就可以访问云端的数据。

### Q: 如何更换密码？
A: 目前需要在数据库中直接修改用户记录。未来可以考虑添加密码修改功能。

### Q: 数据会丢失吗？
A: 不会。所有数据都存储在 Supabase 云端，即使删除浏览器数据，云端数据依然存在。

### Q: 如何备份数据？
A:
1. 在 Supabase Dashboard 中导出数据库
2. 或者在 Supabase Storage 中下载所有照片

## 监控和日志

### 查看 Zeabur 部署日志
1. 登录 Zeabur Dashboard
2. 选择你的项目
3. 点击 **Deployment** 查看部署日志
4. 点击 **Logs** 查看运行日志

### 查看 Supabase 使用情况
1. 登录 Supabase Dashboard
2. 选择你的项目
3. 查看 **Database** → **Usage** 查看数据库使用情况
4. 查看 **Storage** → **Usage** 查看存储使用情况

## 成本估算

### Zeabur
- 免费套餐：每月 $5 额度
- 适合个人使用和小型项目

### Supabase
- 免费套餐：
  - 500 MB 数据库存储
  - 1 GB 文件存储
  - 2 GB 带宽/月
- 付费套餐：
  - Pro: $25/月
  - 更多的存储和带宽

## 更新和维护

### 更新应用
1. 修改代码
2. 推送到 GitHub
3. Zeabur 会自动重新部署（如果启用了自动部署）

### 更新环境变量
1. 在 Zeabur Dashboard 中修改环境变量
2. 重启服务

## 安全建议

1. **定期更改密码** - 虽然更换密码不方便，但建议定期更换
2. **使用强密码** - 至少8位，包含字母、数字、特殊字符
3. **启用 HTTPS** - Zeabur 自动提供 SSL 证书
4. **限制访问** - 如果是私人网站，可以考虑添加访问限制

## 未来改进

可以考虑的功能：
1. 添加密码修改功能
2. 添加实时同步（使用 Supabase Realtime）
3. 添加数据导出功能
4. 添加多用户支持（如果需要）
5. 添加照片缩略图优化
